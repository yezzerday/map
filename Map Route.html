<!DOCTYPE html>
<html>
<head>
    <title>Map Route with Current Location</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBdiQ-7RNfSvjBz27tgZ3U495rtCe-xJCE&libraries=places"></script>
    <style>
        #map {
            height: 100%;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        function initMap() {
            // กำหนดพิกัดปลายทาง
            const end = { lat: 13.7852, lng: 100.5065 }; // ตัวอย่างพิกัดปลายทาง

            // สร้างแผนที่
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 14,
            });

            // ใช้ Geolocation API เพื่อดึงตำแหน่งปัจจุบันของผู้ใช้
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const start = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                    };

                    // แสดงตำแหน่งปัจจุบันบนแผนที่
                    const marker = new google.maps.Marker({
                        position: start,
                        map: map,
                        title: "You are here",
                    });
                    map.setCenter(start);

                    // คำนวณเส้นทางจากตำแหน่งปัจจุบันไปยังปลายทาง
                    const directionsService = new google.maps.DirectionsService();
                    const directionsRenderer = new google.maps.DirectionsRenderer();
                    directionsRenderer.setMap(map);

                    const request = {
                        origin: start,
                        destination: end,
                        travelMode: google.maps.TravelMode.DRIVING,
                    };

                    directionsService.route(request, (result, status) => {
                        if (status === google.maps.DirectionsStatus.OK) {
                            directionsRenderer.setDirections(result);
                        } else {
                            console.error('Directions request failed due to ' + status);
                        }
                    });
                }, () => {
                    handleLocationError(true, map.getCenter());
                });
            } else {
                // ถ้าไม่สามารถใช้งาน Geolocation ได้
                handleLocationError(false, map.getCenter());
            }
        }

        function handleLocationError(browserHasGeolocation, pos) {
            alert(browserHasGeolocation
                ? "Error: The Geolocation service failed."
                : "Error: Your browser doesn't support geolocation.");
        }

        window.onload = initMap;
    </script>
</body>
</html>
